<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>College Recommender</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f0f0f0; }
    input, select, button { padding: 0.5rem; margin: 0.5rem 0; }
    .results { margin-top: 2rem; background: white; padding: 1rem; border-radius: 8px; }
    .college { margin-bottom: 1rem; }
    .branch { margin-left: 1rem; }
  </style>
</head>
<body>
  <h1>College Recommendation</h1>
  <h4>based on cutoffs of 2024 CAP Round I</h4>
    <h4>Aesthetics coming soon...</h4>


  <label>Percentile:
    <input type="number" id="percentile" step="0.1" placeholder="Enter your percentile" />
  </label><br>

  <label>Category:
    <select id="category">
      <option value="OPEN">OPEN</option>
      <option value="OBC">OBC</option>
      <option value="SC">SC</option>
      <option value="ST">ST</option>
      <option value="VJ">VJ</option>
      <option value="NT1">NT1</option>
      <option value="NT2">NT2</option>
      <option value="NT3">NT3</option>
      <option value="SEBC">SEBC</option>
      <option value="EWS">EWS</option>
      <option value="PWD">PWD</option>
      <option value="DEF">DEF</option>
      <option value="TFWS">TFWS</option>
      <option value="ORPHAN">ORPHAN</option>
    </select>
  </label><br>

  <button onclick="recommend()">Get Recommendations</button>
<input type="text" id="liveSearch" placeholder="Search college or branch..." oninput="liveSearchResults()" />
<p>Legends: Starting character G-General, L-Ladies, End character H-Home University, O-Other than Home University,S-State Level, AI- All India Seat.</p>

  <div class="results" id="results"></div>

  <script>
    function liveSearchResults() {
  const keyword = document.getElementById("liveSearch").value.toLowerCase();
  const collegeDivs = document.querySelectorAll(".college");

  collegeDivs.forEach(college => {
    const collegeName = college.querySelector("h3").textContent.toLowerCase();
    const branchTexts = Array.from(college.querySelectorAll(".branch")).map(
      b => b.textContent.toLowerCase()
    );

    const matchFound =
      collegeName.includes(keyword) ||
      branchTexts.some(text => text.includes(keyword));

    college.style.display = matchFound ? "block" : "none";
  });
}

    let collegeData = {};

    const categoryMap = {
      "OPEN": ["GOPENS", "LOPENS", "GOPENH", "LOPENH", "GOPENO", "LOPENO", "PWDOPENS", "PWDOPENH"],
      "OBC": ["GOBCS", "LOBCS", "GOBCH", "LOBCH", "GOBCO", "LOBCO", "PWDOBCS", "PWDOBCH", "PWDROBCS", "DEFROBCS", "DEFOBCS"],
      "SC": ["GSCS", "LSCS", "GSCH", "LSCH", "PWDSCS", "DEFSCS", "DEFRSCS", "PWDRSCS"],
      "ST": ["GSTS", "LSTS", "GSTH", "LSTH", "GSTO", "LSTO", "PWDRSTS"],
      "VJ": ["GVJS", "LVJS", "GVJH", "LVJH", "GVJO", "LVJO"],
      "NT1": ["GNT1S", "LNT1S", "GNT1H", "LNT1H", "GNT1O", "LNT1O", "DEFRNT1S"],
      "NT2": ["GNT2S", "LNT2S", "GNT2H", "LNT2H", "GNT2O", "LNT2O", "DEFRNT2S", "PWDRNT2S"],
      "NT3": ["GNT3S", "LNT3S", "GNT3H", "LNT3H", "GNT3O", "LNT3O"],
      "SEBC": ["GSEBCS", "LSEBCS", "GSEBCH", "LSEBCH", "GSEBCO", "LSEBCO", "DEFSEBCS"],
      "EWS": ["EWS"],
      "PWD": ["PWDOPENS", "PWDOPENH", "PWDSCS", "PWDOBCS", "PWDOBCH", "PWDRSCS", "PWDRSTS", "PWDRNT2S"],
      "DEF": ["DEFOPENS", "DEFOBCS", "DEFSCS", "DEFROBCS", "DEFSEBCS", "DEFRNT1S", "DEFRSCS", "DEFRNT2S"],
      "TFWS": ["TFWS"],
      "ORPHAN": ["ORPHAN"]
    };

    fetch("data.json")
      .then(res => res.json())
      .then(json => {
        collegeData = json;
        console.log("Data loaded");
      })
      .catch(err => {
        document.getElementById("results").innerText = "Error loading data.";
        console.error("Failed to load data.json", err);
      });

    function recommend() {
      const percentile = parseFloat(document.getElementById("percentile").value);
      const selectedGroup = document.getElementById("category").value;
      const validCategories = categoryMap[selectedGroup] || [];
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (!collegeData || Object.keys(collegeData).length === 0) {
        resultsDiv.innerText = "Data is still loading...";
        return;
      }

      const collegeMatches = [];

      for (const [collegeName, details] of Object.entries(collegeData)) {
        const matchingBranches = [];

        for (const branch of details.branches) {
          for (const cutoff of branch.cutoffs || []) {
            if (
              validCategories.includes(cutoff.category) &&
              cutoff.percentile >= percentile - 5 &&
              cutoff.percentile <= percentile + 5
            ) {
              matchingBranches.push({ branch: branch.branch, cutoff });
              break;
            }
          }
        }

        if (matchingBranches.length > 0) {
          matchingBranches.sort((a, b) => b.cutoff.percentile - a.cutoff.percentile);

          collegeMatches.push({
            collegeName,
            branches: matchingBranches,
            highestCutoff: matchingBranches[0].cutoff.percentile
          });
        }
      }

      collegeMatches.sort((a, b) => b.highestCutoff - a.highestCutoff);

      collegeMatches.forEach(college => {
        const collegeEl = document.createElement("div");
        collegeEl.className = "college";
        collegeEl.innerHTML = `<h3>${college.collegeName}</h3>`;

        college.branches.forEach(b => {
          collegeEl.innerHTML += `
            <div class="branch">
              <strong>${b.branch}</strong><br/>
              Caste: <b>${b.cutoff.category}</b><br/>
              Required: ${b.cutoff.percentile} | Your: ${percentile}
            </div>
          `;
        });

        resultsDiv.appendChild(collegeEl);
      });
    }
    
  </script>

</body>
</html>
