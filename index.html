<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>College Recommender</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
<h1><i class="fas fa-compass" style="margin-right: 10px;"></i> CAP_Compass</h1>
  <h4>Based on CAP Round I (2024)</h4>
  <label>Percentile:
    <input type="number" id="percentile" step="0.1" placeholder="Enter your percentile" />
  </label><br>

  <label>Category:
    <select id="category">
      <option value="OPEN">OPEN</option>
      <option value="OBC">OBC</option>
      <option value="SC">SC</option>
      <option value="ST">ST</option>
      <option value="VJ">VJ</option>
      <option value="NT1">NT1</option>
      <option value="NT2">NT2</option>
      <option value="NT3">NT3</option>
      <option value="SEBC">SEBC</option>
      <option value="EWS">EWS</option>
      <option value="PWD">PWD</option>
      <option value="DEF">DEF</option>
      <option value="TFWS">TFWS</option>
      <option value="ORPHAN">ORPHAN</option>
      <option value="MI">MI</option>
    </select>
  </label><br>

  <label>Display Mode:
    <select id="viewMode">
              <option value="flat">Flat Ranked List</option>

      <option value="grouped">Group by College</option>
    </select>
  </label><br>

  <button onclick="recommend()">Get Recommendations</button>
  <input type="text" id="liveSearch" placeholder="Search college or branch..." oninput="liveSearchResults()" />

  <p>Legends: G - General, L - Ladies, H - Home Univ, O - Other Univ, S - State Level, AI - All India</p>

  <div class="results" id="results"></div>

  <script>
    function liveSearchResults() {
      const keyword = document.getElementById("liveSearch").value.toLowerCase();
      const collegeDivs = document.querySelectorAll(".college");

      collegeDivs.forEach(college => {
        const text = college.textContent.toLowerCase();
        college.style.display = text.includes(keyword) ? "block" : "none";
      });
    }

    let collegeData = {};

    const categoryMap = {
      "OPEN": ["GOPENS", "LOPENS", "GOPENH", "LOPENH", "GOPENO", "LOPENO", "PWDOPENS", "PWDOPENH"],
      "OBC": ["GOBCS", "LOBCS", "GOBCH", "LOBCH", "GOBCO", "LOBCO", "PWDOBCS", "PWDOBCH", "PWDROBCS", "DEFROBCS", "DEFOBCS"],
      "SC": ["GSCS", "LSCS", "GSCH", "LSCH", "PWDSCS", "DEFSCS", "DEFRSCS", "PWDRSCS"],
      "ST": ["GSTS", "LSTS", "GSTH", "LSTH", "GSTO", "LSTO", "PWDRSTS"],
      "VJ": ["GVJS", "LVJS", "GVJH", "LVJH", "GVJO", "LVJO"],
      "NT1": ["GNT1S", "LNT1S", "GNT1H", "LNT1H", "GNT1O", "LNT1O", "DEFRNT1S"],
      "NT2": ["GNT2S", "LNT2S", "GNT2H", "LNT2H", "GNT2O", "LNT2O", "DEFRNT2S", "PWDRNT2S"],
      "NT3": ["GNT3S", "LNT3S", "GNT3H", "LNT3H", "GNT3O", "LNT3O"],
      "SEBC": ["GSEBCS", "LSEBCS", "GSEBCH", "LSEBCH", "GSEBCO", "LSEBCO", "DEFSEBCS"],
      "EWS": ["EWS"],
      "PWD": ["PWDOPENS", "PWDOPENH", "PWDSCS", "PWDOBCS", "PWDOBCH", "PWDRSCS", "PWDRSTS", "PWDRNT2S"],
      "DEF": ["DEFOPENS", "DEFOBCS", "DEFSCS", "DEFROBCS", "DEFSEBCS", "DEFRNT1S", "DEFRSCS", "DEFRNT2S"],
      "TFWS": ["TFWS"],
      "ORPHAN": ["ORPHAN"],
      "MI": ["MI"]
    };

    fetch("data.json")
      .then(res => res.json())
      .then(json => {
        collegeData = json;
      })
      .catch(err => {
        document.getElementById("results").innerText = "Error loading data.";
        console.error("Failed to load data.json", err);
      });

    function recommend() {
      const percentile = parseFloat(document.getElementById("percentile").value);
      const selectedGroup = document.getElementById("category").value;
      const viewMode = document.getElementById("viewMode").value;
      const validCategories = categoryMap[selectedGroup] || [];
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (!collegeData || Object.keys(collegeData).length === 0) {
        resultsDiv.innerText = "Data is still loading...";
        return;
      }

      const matchingData = [];

      for (const [collegeName, details] of Object.entries(collegeData)) {
        for (const branch of details.branches) {
          for (const cutoff of branch.cutoffs || []) {
            if (
              validCategories.includes(cutoff.category) &&
              cutoff.percentile >= percentile - 3 &&
              cutoff.percentile <= percentile + 1.5
            ) {
              matchingData.push({
                collegeName,
                branchName: branch.branch,
                category: cutoff.category,
                cutoffPercentile: cutoff.percentile
              });
            }
          }
        }
      }

      matchingData.sort((a, b) => b.cutoffPercentile - a.cutoffPercentile);

      if (viewMode === "flat") {
        matchingData.forEach((entry, index) => {
          const entryEl = document.createElement("div");
          entryEl.className = "college";
          entryEl.innerHTML = `
            <h3 class="college-name">${index + 1}) ${entry.collegeName}</h3>
            <div class="branch">
              <span class="branch-name">${entry.branchName}</span><br/>
              Caste: <b>${entry.category}</b><br/>
              Required: ${entry.cutoffPercentile} | Your: ${percentile}
            </div>
          `;
          resultsDiv.appendChild(entryEl);
        });
      } else {
        const grouped = {};
        matchingData.forEach(entry => {
          if (!grouped[entry.collegeName]) grouped[entry.collegeName] = [];
          grouped[entry.collegeName].push(entry);
        });

        let i = 1;
        for (const [collegeName, branches] of Object.entries(grouped)) {
          const collegeEl = document.createElement("div");
          collegeEl.className = "college";
          collegeEl.innerHTML = `<h3 class="college-name">${i++}) ${collegeName}</h3>`;
          branches.forEach(b => {
            collegeEl.innerHTML += `
              <div class="branch">
                <span class="branch-name">${b.branchName}</span><br/>
                Caste: <b>${b.category}</b><br/>
                Required: ${b.cutoffPercentile} | Your: ${percentile}
              </div>
            `;
          });
          resultsDiv.appendChild(collegeEl);
        }
      }
    }

document.addEventListener('DOMContentLoaded', function() {
  // Prevent any desktop-style overrides
  document.body.classList.add('mobile-rendering');
  
  // Force mobile viewport
  const viewportMeta = document.createElement('meta');
  viewportMeta.name = 'viewport';
  viewportMeta.content = 'width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no';
  document.head.appendChild(viewportMeta);
});


  </script>
</body>
</html>
